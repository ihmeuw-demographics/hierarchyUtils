<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregate/Scale a detailed level of a hierarchical variable to an
aggregate level — agg • hierarchyUtils</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Aggregate/Scale a detailed level of a hierarchical variable to an
aggregate level — agg" />
<meta property="og:description" content="Aggregate counts or probabilities from a detailed level of a
hierarchical variable to an aggregate level or scale the detailed level
values so that the detailed level aggregated together equals the aggregate
level." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hierarchyUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hierarchyUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/agg_scale_performance.html">Aggregation/Scaling performance</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ihmeuw-demographics/hierarchyUtils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate/Scale a detailed level of a hierarchical variable to an
aggregate level</h1>
    <small class="dont-index">Source: <a href='https://github.com/ihmeuw-demographics/hierarchyUtils/blob/master/R/agg_scale.R'><code>R/agg_scale.R</code></a></small>
    <div class="hidden name"><code>agg_scale.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aggregate counts or probabilities from a detailed level of a
hierarchical variable to an aggregate level or scale the detailed level
values so that the detailed level aggregated together equals the aggregate
level.</p>
    </div>

    <pre class="usage"><span class='fu'>agg</span><span class='op'>(</span>
  <span class='va'>dt</span>,
  <span class='va'>id_cols</span>,
  <span class='va'>value_cols</span>,
  <span class='va'>col_stem</span>,
  <span class='va'>col_type</span>,
  <span class='va'>mapping</span>,
  agg_function <span class='op'>=</span> <span class='va'>sum</span>,
  missing_dt_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  present_agg_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  overlapping_dt_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  na_value_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  collapse_interval_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  quiet <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>scale</span><span class='op'>(</span>
  <span class='va'>dt</span>,
  <span class='va'>id_cols</span>,
  <span class='va'>value_cols</span>,
  <span class='va'>col_stem</span>,
  <span class='va'>col_type</span>,
  mapping <span class='op'>=</span> <span class='cn'>NULL</span>,
  agg_function <span class='op'>=</span> <span class='va'>sum</span>,
  missing_dt_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  overlapping_dt_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  na_value_severity <span class='op'>=</span> <span class='st'>"stop"</span>,
  collapse_interval_cols <span class='op'>=</span> <span class='cn'>FALSE</span>,
  collapse_missing <span class='op'>=</span> <span class='cn'>FALSE</span>,
  quiet <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dt</th>
      <td><p>[<code>data.table()</code>]<br />
Data to be aggregated or scaled.</p></td>
    </tr>
    <tr>
      <th>id_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
ID columns that uniquely identify each row of <code>dt</code>.</p></td>
    </tr>
    <tr>
      <th>value_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
Value columns that should be aggregated.</p></td>
    </tr>
    <tr>
      <th>col_stem</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
The name of the variable to be aggregated or scaled over. If aggregating an
'interval' variable should not include the '_start' or '_end' suffix.</p></td>
    </tr>
    <tr>
      <th>col_type</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
The type of variable that is being aggregated or scaled over. Can be either
'categorical' or 'interval'.</p></td>
    </tr>
    <tr>
      <th>mapping</th>
      <td><p>[<code>data.table()</code>]<br />
For 'categorical' variables, defines how different levels of the
hierarchical variable relate to each other. For aggregating 'interval'
variables, it is used to specify intervals to aggregate to, while when
scaling the mapping is inferred from the available intervals in <code>dt</code>.</p></td>
    </tr>
    <tr>
      <th>agg_function</th>
      <td><p>[<code>function()</code>]<br />
Function to use when aggregating, can be either <code>sum</code> (for counts) or
<code>prod</code> (for probabilities).</p></td>
    </tr>
    <tr>
      <th>missing_dt_severity</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
What should happen when <code>dt</code> is missing levels of <code>col_stem</code> that
prevent aggregation or scaling from occurring? Can be either 'skip',
'stop', 'warning', 'message', or 'none'. Default is 'stop'. See section on
'Severity Arguments' for more information.</p></td>
    </tr>
    <tr>
      <th>present_agg_severity</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
What should happen when <code>dt</code> already has requested aggregates (from
<code>mapping</code>)? Can be either 'skip', 'stop', 'warning', 'message',
or 'none'. Default is 'stop'. See section on 'Severity Arguments' for more
information.</p></td>
    </tr>
    <tr>
      <th>overlapping_dt_severity</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
When aggregating/scaling an interval variable or <code>collapse_interval_cols=TRUE</code>
what should happen when overlapping intervals are identified? Can be either
'skip', 'stop', 'warning', 'message', or 'none'. Default is 'stop'. See
section on 'Severity Arguments' for more information.</p></td>
    </tr>
    <tr>
      <th>na_value_severity</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
What should happen when 'NA' values are present in <code>value_cols</code>? Can be
either 'skip', 'stop', 'warning', 'message', or 'none'. Default is 'stop'.
See section on 'Severity Arguments' for more information.</p></td>
    </tr>
    <tr>
      <th>collapse_interval_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
Whether to collapse interval <code>id_cols</code> (not including <code>col_stem</code> if it is
an interval variable). Default is 'False'. If set to 'True' the interval
columns are collapsed to the most detailed common intervals and will error
out if there are overlapping intervals. See details or vignettes for more
information.</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
Should progress messages be suppressed as the function is run? Default is
False.</p></td>
    </tr>
    <tr>
      <th>collapse_missing</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
When scaling a <code>categorical</code> variable, whether to collapse missing
intermediate levels in <code>mapping</code>. Default is 'False' and the function
errors out due to missing data.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>[<code>data.table()</code>] with <code>id_cols</code> and <code>value_cols</code> columns for
requested aggregates or with scaled values.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>agg</code> function can be used to aggregate to different levels of a pre
defined hierarchy. For example a categorical variable like location you can
aggregate the country level to global level or for a numeric 'interval'
variable like age you can aggregate from  five year age-groups to all-ages
combined.</p>
<p>The <code>scale</code> function can be used to scale different levels of hierarchical
variables like location, so that the sub-national level aggregated together
equals the national level. Similarly, it can be used to scale a numeric
'interval' variable like age so that the five year age groups aggregated
together equals the all-ages value.</p>
<p>If 'location' is the variable to be aggregated or scaled then
<code>col_stem = 'location'</code> and 'location' must be included in <code>id_cols.</code> If
'age' is the variable to be aggregated or scaled then <code>col_stem = 'age'</code> and
'age_start' and 'age_end' must be included in <code>id_cols</code> since both variables
are needed to represent interval variables.</p>
<p>The <code>mapping</code> argument defines how different levels of the hierarchical
variable relate to each other. For numeric interval variables the hierarchy
can be inferred while for categorical variables the full hierarchy needs to
be provided.</p>
<p><code>mapping</code> for categorical variables must have columns called 'parent' and
'child' that represent how each possible variable relates to each other.
For example if aggregating or scaling locations then mapping needs to define
how each child location relates to each parent location. It is then assumed
that each parent location in the <code>mapping</code> hierarchy will need to be
aggregated to.</p>
<p><code>mapping</code> for numeric interval variables is only needed when aggregating data
to define exactly which aggregates are needed. It must have columns for
'<code>{col_stem}</code>_start' and '<code>{col_stem}</code>_end' defining the start and end of each
aggregate interval that is need. When scaling data, <code>mapping</code> should be
<code>NULL</code> since the hierarchy can be inferred from the available intervals in
<code>dt</code>.</p>
<p><code>agg</code> and <code>scale</code> work even if <code>dt</code> is not a square dataset. Meaning it is
okay if different combinations of <code>id_vars</code> have different <code>col_stem</code> values
available. For example if making age aggregates, it is okay if some
location-years have 5-year age groups while other location-years have 1-year
age groups.</p>
<p>If <code>collapse_interval_cols = TRUE</code> it is okay if the interval variables
included in <code>id_vars</code> are not all exactly the same, <code>agg</code> and <code>scale</code> will
collapse to the most detailed common intervals
<code><a href='collapse_common_intervals.html'>collapse_common_intervals()</a></code> prior to aggregation or scaling. An example
of this is when aggregating subnational data to the national level (so
<code>col_stem</code> is 'location' and <code>col_type</code> is 'categorical') but each
subnational location contains different age groups. <code>agg()</code> and <code>scale()</code>
first aggregate to the most detailed common age groups before making location
aggregates.</p>
<p>The <code>agg</code> and <code>scale</code> functions currently only work when combining counts or
probabilities. If the data is in rate-space then you need to convert to count
space first, aggregate/scale, and then convert back.</p>
    <h2 class="hasAnchor" id="severity-arguments"><a class="anchor" href="#severity-arguments"></a>Severity Arguments</h2>

    

<p><strong><code>missing_dt_severity</code></strong>:</p>
<p>Check for missing levels of <code>col_stem</code>, the variable being aggregated or
scaled over.</p><ol>
<li><p><code>stop</code>: throw error (this is the default).</p></li>
<li><p><code>warning</code> or <code>message</code>: throw warning/message and continue with
aggregation/scaling for requested aggregations/scalings where expected input
data in <code>dt</code> is available.</p></li>
<li><p><code>none</code>: don't throw error or warning, continue with aggregation/scaling
for requested aggregations/scalings where expected input data in <code>dt</code> is
available.</p></li>
<li><p><code>skip</code>: skip this check and continue with aggregation/scaling.</p></li>
</ol>

<p><strong><code>present_agg_severity</code></strong> (<code>agg</code> only):</p>
<p>Check for requested aggregates in <code>mapping</code> that are already present</p><ol>
<li><p><code>stop</code>: throw error (this is the default).</p></li>
<li><p><code>warning</code> or <code>message</code>: throw warning/message, drop aggregates and continue
with aggregation.</p></li>
<li><p><code>none</code>: don't throw error or warning, drop aggregates and continue with
aggregation.</p></li>
<li><p><code>skip</code>: skip this check and add to the values already present for the
aggregates.</p></li>
</ol>

<p><strong><code>na_value_severity</code></strong>:</p>
<p>Check for 'NA' values in the <code>value_cols</code>.</p><ol>
<li><p><code>stop</code>: throw error (this is the default).</p></li>
<li><p><code>warning</code> or <code>message</code>: throw warning/message, drop missing values and
continue with aggregation/scaling where possible (this likely will cause
another error because of <code>missing_dt_severity</code>, consider setting
<code>missing_dt_severity = "skip"</code> for functionality similiar to <code>na.rm = TRUE</code>).</p></li>
<li><p><code>none</code>: don't throw error or warning, drop missing values and continue
with aggregation/scaling where possible (this likely will cause another error
because of <code>missing_dt_severity</code>, consider setting
<code>missing_dt_severity = "skip"</code> for functionality similiar to <code>na.rm = TRUE</code>).</p></li>
<li><p><code>skip</code>: skip this check and propagate <code>NA</code> values through
aggregation/scaling.</p></li>
</ol>

<p><strong><code>overlapping_dt_severity</code></strong>:
Check for overlapping intervals that prevent collapsing to the most detailed
common set of intervals. Or check for overlapping intervals in <code>col_stem</code>
when aggregating/scaling.</p><ol>
<li><p><code>stop</code>: throw error (this is the default).</p></li>
<li><p><code>warning</code> or <code>message</code>: throw warning/message, drop overlapping intervals
and continue with aggregation/scaling where possible (this may cause another
error because of <code>missing_dt_severity</code>).</p></li>
<li><p><code>none</code>: don't throw error or warning, drop overlapping intervals and
continue with aggregation/scaling where possible (this may cause another
error because of <code>missing_dt_severity</code>).</p></li>
<li><p><code>skip</code>: skip this check and continue with aggregation/scaling.</p></li>
</ol>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># aggregate count data from present day Iran provinces to historical</span>
<span class='co'># provinces and Iran as a whole</span>
<span class='va'>input_dt</span> <span class='op'>&lt;-</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/J.html'>CJ</a></span><span class='op'>(</span>location <span class='op'>=</span> <span class='va'>iran_mapping</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"[0-9]+"</span>, <span class='va'>child</span><span class='op'>)</span>,
                                                   <span class='va'>child</span><span class='op'>]</span>,
                           year <span class='op'>=</span> <span class='fl'>2011</span>,
                           value <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>output_dt</span> <span class='op'>&lt;-</span> <span class='fu'>agg</span><span class='op'>(</span>dt <span class='op'>=</span> <span class='va'>input_dt</span>,
                 id_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"location"</span>, <span class='st'>"year"</span><span class='op'>)</span>,
                 value_cols <span class='op'>=</span> <span class='st'>"value"</span>,
                 col_stem <span class='op'>=</span> <span class='st'>"location"</span>,
                 col_type <span class='op'>=</span> <span class='st'>"categorical"</span>,
                 mapping <span class='op'>=</span> <span class='va'>iran_mapping</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Aggregating location</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 1 of 15: Tehran 2006</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 2 of 15: Tehran 1986-1995</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 3 of 15: Markazi 1966-1976</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 4 of 15: Markazi 1956</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 5 of 15: Zanjan 1976-1996</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 6 of 15: Gilan 1956-1966</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 7 of 15: Mazandaran 1956-1996</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 8 of 15: East Azarbayejan 1956-1986</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 9 of 15: Kermanshahan 1956</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 10 of 15: Khuzestan and Lorestan 1956</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 11 of 15: Fars and Ports 1956</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 12 of 15: Khorasan 1956-1996</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 13 of 15: Isfahan and Yazd 1966</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 14 of 15: Isfahan and Yazd 1956</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 15 of 15: Iran (Islamic Republic of)</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='input'>
<span class='co'># scale count data from present day Iran provinces to Iran national value</span>
<span class='va'>input_dt</span> <span class='op'>&lt;-</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/J.html'>CJ</a></span><span class='op'>(</span>location <span class='op'>=</span> <span class='va'>iran_mapping</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grepl</a></span><span class='op'>(</span><span class='st'>"[0-9]+"</span>, <span class='va'>child</span><span class='op'>)</span>,
                                                   <span class='va'>child</span><span class='op'>]</span>,
                           year <span class='op'>=</span> <span class='fl'>2011</span>,
                           value <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>input_dt_agg</span> <span class='op'>&lt;-</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>
  location <span class='op'>=</span> <span class='st'>"Iran (Islamic Republic of)"</span>,
  year <span class='op'>=</span> <span class='fl'>2011</span>, value <span class='op'>=</span> <span class='fl'>62</span>
<span class='op'>)</span>
<span class='va'>input_dt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>input_dt</span>, <span class='va'>input_dt_agg</span><span class='op'>)</span>
<span class='va'>output_dt</span> <span class='op'>&lt;-</span> <span class='fu'>scale</span><span class='op'>(</span>dt <span class='op'>=</span> <span class='va'>input_dt</span>,
                   id_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"location"</span>, <span class='st'>"year"</span><span class='op'>)</span>,
                   value_cols <span class='op'>=</span> <span class='st'>"value"</span>,
                   col_stem <span class='op'>=</span> <span class='st'>"location"</span>,
                   col_type <span class='op'>=</span> <span class='st'>"categorical"</span>,
                   mapping <span class='op'>=</span> <span class='va'>iran_mapping</span>,
                   collapse_missing <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Scaling location</span></div><div class='output co'>#&gt; <span class='message'>Scaling 1 of 1: Iran (Islamic Republic of)</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='input'>
<span class='co'># aggregate age-specific count data</span>
<span class='va'>input_dt</span> <span class='op'>&lt;-</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>year <span class='op'>=</span> <span class='fl'>2010</span>,
                        age_start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>95</span>, <span class='fl'>1</span><span class='op'>)</span>,
                        value1 <span class='op'>=</span> <span class='fl'>1</span>, value2 <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='gen_end.html'>gen_end</a></span><span class='op'>(</span><span class='va'>input_dt</span>, id_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"year"</span>, <span class='st'>"age_start"</span><span class='op'>)</span>, col_stem <span class='op'>=</span> <span class='st'>"age"</span><span class='op'>)</span>
<span class='va'>age_mapping</span> <span class='op'>&lt;-</span> <span class='fu'>data.table</span><span class='fu'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span><span class='op'>(</span>age_start <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>15</span>, <span class='fl'>85</span><span class='op'>)</span>,
                                      age_end <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>60</span>, <span class='cn'>Inf</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>output_dt</span> <span class='op'>&lt;-</span> <span class='fu'>agg</span><span class='op'>(</span>dt <span class='op'>=</span> <span class='va'>input_dt</span>,
                 id_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"year"</span>, <span class='st'>"age_start"</span>, <span class='st'>"age_end"</span><span class='op'>)</span>,
                 value_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"value1"</span>, <span class='st'>"value2"</span><span class='op'>)</span>,
                 col_stem <span class='op'>=</span> <span class='st'>"age"</span>,
                 col_type <span class='op'>=</span> <span class='st'>"interval"</span>,
                 mapping <span class='op'>=</span> <span class='va'>age_mapping</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Aggregating age</span></div><div class='output co'>#&gt; <span class='message'>Interval group 1 of 1: [0, 1),[1, 2),[2, 3),[3, 4),[4, 5),[5, 6),[6, 7),[7, 8),[8, 9),[9, 10),[10, 11),[11, 12),[12, 13),[13, 14),[14, 15),[15, 16),[16, 17),[17, 18),[18, 19),[19, 20),[20, 21),[21, 22),[22, 23),[23, 24),[24, 25),[25, 26),[26, 27),[27, 28),[28, 29),[29, 30),[30, 31),[31, 32),[32, 33),[33, 34),[34, 35),[35, 36),[36, 37),[37, 38),[38, 39),[39, 40),[40, 41),[41, 42),[42, 43),[43, 44),[44, 45),[45, 46),[46, 47),[47, 48),[48, 49),[49, 50),[50, 51),[51, 52),[52, 53),[53, 54),[54, 55),[55, 56),[56, 57),[57, 58),[58, 59),[59, 60),[60, 61),[61, 62),[62, 63),[63, 64),[64, 65),[65, 66),[66, 67),[67, 68),[68, 69),[69, 70),[70, 71),[71, 72),[72, 73),[73, 74),[74, 75),[75, 76),[76, 77),[77, 78),[78, 79),[79, 80),[80, 81),[81, 82),[82, 83),[83, 84),[84, 85),[85, 86),[86, 87),[87, 88),[88, 89),[89, 90),[90, 91),[91, 92),[92, 93),[93, 94),[94, 95),[95, Inf)</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 1 of 3: [0, 5)</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 2 of 3: [15, 60)</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='message'>Aggregate 3 of 3: [85, Inf)</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='input'>
<span class='co'># scale age-specific probability data</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Charlton Callender, Grant Nguyen, Katie Paulson, Spencer Pease, Haidong Wang, Institute for Health Metrics and Evaluation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


