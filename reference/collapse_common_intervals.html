<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Collapse an interval variable to the most detailed common set of
intervals — collapse_common_intervals • hierarchyUtils</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Collapse an interval variable to the most detailed common set of
intervals — collapse_common_intervals" />
<meta property="og:description" content="Collapse an interval variable to the most detailed common set of
intervals available for each combination of id_cols in a dataset.
Aggregates the collapsed dataset to the common set of intervals." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hierarchyUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hierarchyUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ihmeuw-demographics/hierarchyUtils/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Collapse an interval variable to the most detailed common set of
intervals</h1>
    <small class="dont-index">Source: <a href='https://github.com/ihmeuw-demographics/hierarchyUtils/blob/master/R/interval_collapse.R'><code>R/interval_collapse.R</code></a></small>
    <div class="hidden name"><code>collapse_common_intervals.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Collapse an interval variable to the most detailed common set of
intervals available for each combination of <code>id_cols</code> in a dataset.
Aggregates the collapsed dataset to the common set of intervals.</p>
    </div>

    <pre class="usage"><span class='fu'>collapse_common_intervals</span>(
  <span class='no'>dt</span>,
  <span class='no'>id_cols</span>,
  <span class='no'>value_cols</span>,
  <span class='no'>col_stem</span>,
  <span class='kw'>agg_function</span> <span class='kw'>=</span> <span class='no'>sum</span>,
  <span class='kw'>missing_dt_severity</span> <span class='kw'>=</span> <span class='st'>"stop"</span>,
  <span class='kw'>drop_present_aggs</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>include_missing</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dt</th>
      <td><p>[<code>data.table()</code>]<br />
Dataset containing the interval variable.</p></td>
    </tr>
    <tr>
      <th>id_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
ID columns that uniquely identify each row of <code>dt</code>.</p></td>
    </tr>
    <tr>
      <th>value_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
Value columns that should be aggregated.</p></td>
    </tr>
    <tr>
      <th>col_stem</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
The name of the variable to collapse, should not include the '_start' or
'_end' suffix for the interval variable.</p></td>
    </tr>
    <tr>
      <th>agg_function</th>
      <td><p>[<code>function()</code>]<br />
Function to use when aggregating, can be either <code>sum</code> (for counts) or
<code>prod</code> (for probabilities).</p></td>
    </tr>
    <tr>
      <th>missing_dt_severity</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
How severe should the consequences of missing intervals that prevent
collapsing to the most detailed common set of intervals be? Can be either
'stop', 'warning', 'message', or 'none'. If not "stop", then only the
intervals that can be correctly collapsed will be done.</p></td>
    </tr>
    <tr>
      <th>drop_present_aggs</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
Whether to drop aggregates (or overlapping intervals) that are already
present in <code>dt</code> before aggregating. Default is 'False' and the function
errors out.</p></td>
    </tr>
    <tr>
      <th>include_missing</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
Whether to include missing intervals in the identified most detailed common
intervals. These missing intervals are not present in all combinations of
<code>id_cols</code>. Default is "FALSE".</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>[<code>data.table()</code>] with <code>id_cols</code> and <code>value_cols</code> columns but with
the <code>col_stem</code> intervals reduced to only the most detailed common set of
intervals.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>id_cols</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"year_start"</span>, <span class='st'>"year_end"</span>, <span class='st'>"sex"</span>, <span class='st'>"age_start"</span>, <span class='st'>"age_end"</span>)
<span class='no'>value_cols</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"value"</span>)

<span class='co'># set up test input data.table</span>
<span class='no'>input_dt_male</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>data.table</span><span class='kw ns'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/J.html'>CJ</a></span>(<span class='kw'>year_start</span> <span class='kw'>=</span> <span class='fl'>2005</span>, <span class='kw'>year_end</span> <span class='kw'>=</span> <span class='fl'>2010</span>,
                                <span class='kw'>sex</span> <span class='kw'>=</span> <span class='st'>"male"</span>,
                                <span class='kw'>age_start</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>95</span>, <span class='fl'>5</span>),
                                <span class='kw'>value</span> <span class='kw'>=</span> <span class='fl'>25</span>)
<span class='no'>input_dt_male</span>[<span class='no'>age_start</span> <span class='kw'>==</span> <span class='fl'>95</span>, <span class='no'>value</span> <span class='kw'>:=</span> <span class='fl'>5</span>]</div><div class='output co'>#&gt;     year_start year_end  sex age_start value
#&gt;  1:       2005     2010 male         0    25
#&gt;  2:       2005     2010 male         5    25
#&gt;  3:       2005     2010 male        10    25
#&gt;  4:       2005     2010 male        15    25
#&gt;  5:       2005     2010 male        20    25
#&gt;  6:       2005     2010 male        25    25
#&gt;  7:       2005     2010 male        30    25
#&gt;  8:       2005     2010 male        35    25
#&gt;  9:       2005     2010 male        40    25
#&gt; 10:       2005     2010 male        45    25
#&gt; 11:       2005     2010 male        50    25
#&gt; 12:       2005     2010 male        55    25
#&gt; 13:       2005     2010 male        60    25
#&gt; 14:       2005     2010 male        65    25
#&gt; 15:       2005     2010 male        70    25
#&gt; 16:       2005     2010 male        75    25
#&gt; 17:       2005     2010 male        80    25
#&gt; 18:       2005     2010 male        85    25
#&gt; 19:       2005     2010 male        90    25
#&gt; 20:       2005     2010 male        95     5</div><div class='input'><span class='no'>input_dt_female</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>data.table</span><span class='kw ns'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/J.html'>CJ</a></span>(<span class='kw'>year_start</span> <span class='kw'>=</span> <span class='fl'>2005</span>:<span class='fl'>2009</span>,
                                  <span class='kw'>sex</span> <span class='kw'>=</span> <span class='st'>"female"</span>,
                                  <span class='kw'>age_start</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>95</span>, <span class='fl'>1</span>),
                                  <span class='kw'>value</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='fu'><a href='gen_interval_cols.html'>gen_end</a></span>(<span class='no'>input_dt_female</span>, <span class='fu'><a href='https://rdrr.io/r/base/sets.html'>setdiff</a></span>(<span class='no'>id_cols</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"year_end"</span>, <span class='st'>"age_end"</span>)),
        <span class='kw'>col_stem</span> <span class='kw'>=</span> <span class='st'>"year"</span>, <span class='kw'>right_most_endpoint</span> <span class='kw'>=</span> <span class='fl'>2010</span>)
<span class='no'>input_dt</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(<span class='no'>input_dt_male</span>, <span class='no'>input_dt_female</span>)
<span class='fu'><a href='gen_interval_cols.html'>gen_end</a></span>(<span class='no'>input_dt</span>, <span class='fu'><a href='https://rdrr.io/r/base/sets.html'>setdiff</a></span>(<span class='no'>id_cols</span>, <span class='st'>"age_end"</span>), <span class='kw'>col_stem</span> <span class='kw'>=</span> <span class='st'>"age"</span>)
<span class='kw pkg'>data.table</span><span class='kw ns'>::</span><span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/setkey.html'>setkeyv</a></span>(<span class='no'>input_dt</span>, <span class='no'>id_cols</span>)


<span class='no'>collapsed_dt</span> <span class='kw'>&lt;-</span> <span class='fu'>collapse_common_intervals</span>(
  <span class='kw'>dt</span> <span class='kw'>=</span> <span class='no'>input_dt</span>,
  <span class='kw'>id_cols</span> <span class='kw'>=</span> <span class='no'>id_cols</span>,
  <span class='kw'>value_cols</span> <span class='kw'>=</span> <span class='no'>value_cols</span>,
  <span class='kw'>col_stem</span> <span class='kw'>=</span> <span class='st'>"year"</span>
)
<span class='no'>collapsed_dt</span> <span class='kw'>&lt;-</span> <span class='fu'>collapse_common_intervals</span>(
  <span class='kw'>dt</span> <span class='kw'>=</span> <span class='no'>collapsed_dt</span>,
  <span class='kw'>id_cols</span> <span class='kw'>=</span> <span class='no'>id_cols</span>,
  <span class='kw'>value_cols</span> <span class='kw'>=</span> <span class='no'>value_cols</span>,
  <span class='kw'>col_stem</span> <span class='kw'>=</span> <span class='st'>"age"</span>
)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Charlton Callender, Grant Nguyen, Katie Paulson, Spencer Pease, Haidong Wang, Institute for Health Metrics and Evaluation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


