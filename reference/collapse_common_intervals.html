<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Collapse an interval variable to the most detailed common set of intervals — collapse_common_intervals • hierarchyUtils</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Collapse an interval variable to the most detailed common set of intervals — collapse_common_intervals"><meta property="og:description" content="Collapse an interval variable to the most detailed common set of
intervals available for each combination of id_cols in a dataset.
Aggregates the collapsed dataset to the common set of intervals."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hierarchyUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/hierarchyUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/agg_scale_performance.html">Aggregation/Scaling performance</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ihmeuw-demographics/hierarchyUtils/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Collapse an interval variable to the most detailed common set of intervals</h1>
    <small class="dont-index">Source: <a href="https://github.com/ihmeuw-demographics/hierarchyUtils/blob/HEAD/R/interval_collapse.R" class="external-link"><code>R/interval_collapse.R</code></a></small>
    <div class="hidden name"><code>collapse_common_intervals.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Collapse an interval variable to the most detailed common set of
intervals available for each combination of <code>id_cols</code> in a dataset.
Aggregates the collapsed dataset to the common set of intervals.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">collapse_common_intervals</span><span class="op">(</span></span>
<span>  <span class="va">dt</span>,</span>
<span>  <span class="va">id_cols</span>,</span>
<span>  <span class="va">value_cols</span>,</span>
<span>  <span class="va">col_stem</span>,</span>
<span>  agg_function <span class="op">=</span> <span class="va">sum</span>,</span>
<span>  missing_dt_severity <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>  overlapping_dt_severity <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>  include_missing <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>dt</dt>
<dd><p>[<code>data.table()</code>]<br>
Dataset containing the interval variable.</p></dd>


<dt>id_cols</dt>
<dd><p>[<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>]<br>
ID columns that uniquely identify each row of <code>dt</code>.</p></dd>


<dt>value_cols</dt>
<dd><p>[<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>]<br>
Value columns that should be aggregated.</p></dd>


<dt>col_stem</dt>
<dd><p>[<code>character(1)</code>]<br>
The name of the variable to collapse, should not include the '_start' or
'_end' suffix for the interval variable.</p></dd>


<dt>agg_function</dt>
<dd><p>[<code>function()</code>]<br>
Function to use when aggregating, can be either <code>sum</code> (for counts) or
<code>prod</code> (for probabilities).</p></dd>


<dt>missing_dt_severity</dt>
<dd><p>[<code>character(1)</code>]<br>
How severe should the consequences of missing intervals that prevent
collapsing to the most detailed common set of intervals be? Can be either
'skip', 'stop', 'warning', 'message', or 'none'. If not "stop", then only the
intervals that can be correctly collapsed will be done.</p></dd>


<dt>overlapping_dt_severity</dt>
<dd><p>[<code>character(1)</code>]<br>
When aggregating/scaling an interval variable or <code>collapse_interval_cols=TRUE</code>
what should happen when overlapping intervals are identified? Can be either
'skip', 'stop', 'warning', 'message', or 'none'. Default is 'stop'. See
section on 'Severity Arguments' for more information.</p></dd>


<dt>include_missing</dt>
<dd><p>[<code>logical(1)</code>]<br>
Whether to include missing intervals in the identified most detailed common
intervals. These missing intervals are not present in all combinations of
<code>id_cols</code>. Default is "FALSE".</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>[<code>data.table()</code>] with <code>id_cols</code> and <code>value_cols</code> columns but with
the <code>col_stem</code> intervals reduced to only the most detailed common set of
intervals.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">id_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year_start"</span>, <span class="st">"year_end"</span>, <span class="st">"sex"</span>, <span class="st">"age_start"</span>, <span class="st">"age_end"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">value_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set up test input data.table</span></span></span>
<span class="r-in"><span><span class="va">input_dt_male</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/J.html" class="external-link">CJ</a></span><span class="op">(</span>year_start <span class="op">=</span> <span class="fl">2005</span>, year_end <span class="op">=</span> <span class="fl">2010</span>,</span></span>
<span class="r-in"><span>                                sex <span class="op">=</span> <span class="st">"male"</span>,</span></span>
<span class="r-in"><span>                                age_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">95</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                value <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input_dt_male</span><span class="op">[</span><span class="va">age_start</span> <span class="op">==</span> <span class="fl">95</span>, <span class="va">value</span> <span class="op">:=</span> <span class="fl">5</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;year_start, year_end, sex, age_start&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Index: &lt;age_start&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     year_start year_end    sex age_start value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          &lt;num&gt;    &lt;num&gt; &lt;char&gt;     &lt;num&gt; &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:       2005     2010   male         0    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:       2005     2010   male         5    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:       2005     2010   male        10    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:       2005     2010   male        15    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:       2005     2010   male        20    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:       2005     2010   male        25    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:       2005     2010   male        30    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:       2005     2010   male        35    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:       2005     2010   male        40    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:       2005     2010   male        45    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:       2005     2010   male        50    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:       2005     2010   male        55    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:       2005     2010   male        60    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:       2005     2010   male        65    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:       2005     2010   male        70    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:       2005     2010   male        75    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:       2005     2010   male        80    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:       2005     2010   male        85    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:       2005     2010   male        90    25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:       2005     2010   male        95     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     year_start year_end    sex age_start value</span>
<span class="r-in"><span><span class="va">input_dt_female</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/J.html" class="external-link">CJ</a></span><span class="op">(</span>year_start <span class="op">=</span> <span class="fl">2005</span><span class="op">:</span><span class="fl">2009</span>,</span></span>
<span class="r-in"><span>                                  sex <span class="op">=</span> <span class="st">"female"</span>,</span></span>
<span class="r-in"><span>                                  age_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">95</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  value <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gen_interval_cols.html">gen_end</a></span><span class="op">(</span><span class="va">input_dt_female</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">id_cols</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year_end"</span>, <span class="st">"age_end"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        col_stem <span class="op">=</span> <span class="st">"year"</span>, right_most_endpoint <span class="op">=</span> <span class="fl">2010</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">input_dt_male</span>, <span class="va">input_dt_female</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gen_interval_cols.html">gen_end</a></span><span class="op">(</span><span class="va">input_dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">id_cols</span>, <span class="st">"age_end"</span><span class="op">)</span>, col_stem <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="va">input_dt</span>, <span class="va">id_cols</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">collapsed_dt</span> <span class="op">&lt;-</span> <span class="fu">collapse_common_intervals</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="va">input_dt</span>,</span></span>
<span class="r-in"><span>  id_cols <span class="op">=</span> <span class="va">id_cols</span>,</span></span>
<span class="r-in"><span>  value_cols <span class="op">=</span> <span class="va">value_cols</span>,</span></span>
<span class="r-in"><span>  col_stem <span class="op">=</span> <span class="st">"year"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">collapsed_dt</span> <span class="op">&lt;-</span> <span class="fu">collapse_common_intervals</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="va">collapsed_dt</span>,</span></span>
<span class="r-in"><span>  id_cols <span class="op">=</span> <span class="va">id_cols</span>,</span></span>
<span class="r-in"><span>  value_cols <span class="op">=</span> <span class="va">value_cols</span>,</span></span>
<span class="r-in"><span>  col_stem <span class="op">=</span> <span class="st">"age"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Charlton Callender, Grant Nguyen, Katie Paulson, Spencer Pease, Haidong Wang, Institute for Health Metrics and Evaluation.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

